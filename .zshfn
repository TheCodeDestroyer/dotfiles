#SYSTEM

function update-system {
  local OS_TYPE=$(uname -s)

  if [[ "${OS_TYPE}" == "Darwin" ]]; then
      brew update && brew upgrade;

      sheldon lock --update;
  elif [[ "${OS_TYPE}" == "Linux" ]]; then
      adg -y && adu -y;
      
      cargo install-update -a && sheldon lock --update;

      sheldon completions --shell zsh > ${ZSH_CACHE_DIR}/completions/_sheldon;
  else
      echo "Unsuported system!"
  fi

  bin-update; mise upgrade -y; mise prune -y; mise install;
}


# CLI AUTH

function auth-docker
{
  echo $(op read $DOCKER_AUTH_TOKEN) | docker login --username $(op read $DOCKER_USERNAME) --password-stdin
}

function auth-convex
{
  echo "{ \"accessToken\": \"$(op read $CONVEX_AUTH_TOKEN)\" }" > ~/.convex/config.json
}

function auth-convex-work
{
  echo "{ \"accessToken\": \"$(op read $CONVEX_WOKR_AUTH_TOKEN)\" }" > ~/.convex/config.json
}


# DOCKER

function docker-connect-minikube
{
  eval $(minikube -p minikube docker-env)
}

# NODE/BUN

function pm
{
  if [[ -f bun.lockb ]] || [[ -f bun.lock ]]; then
    command bun "$@"
  elif [[ -f pnpm-lock.yaml ]]; then
    command pnpm "$@"
  elif [[ -f yarn.lock ]]; then
    command yarn "$@"
  elif [[ -f package-lock.json ]]; then
    command npm "$@"
  else
    command bun "$@"
  fi
}
